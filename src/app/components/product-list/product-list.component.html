<div class="container mt-4">
  <h2>Products Management</h2>

  <div *ngIf="errorMessage" class="alert alert-danger">
    {{ errorMessage }}
  </div>

  <div *ngIf="successMessage" class="alert alert-success">
    {{ successMessage }}
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>Image</th>
          <th>Title</th>
          <th>Price</th>
          <th>Visibility</th>
          <th>Availability</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of products">
          <td>
            <img [src]="product.imageUrl.images[0]"
                 [alt]="product.title"
                 class="product-thumbnail"
                 (error)="handleImageError($event)">
          </td>
          <td>{{ product.title }}</td>
          <td>{{ product.price | currency:'EGP' }}</td>
          <td>
            <span class="badge"
                  [ngClass]="{
                    'bg-success': product.isVisible,
                    'bg-danger': !product.isVisible
                  }">
              {{ product.isVisible ? 'Visible' : 'Hidden' }}
            </span>
          </td>
          <td>
            <span class="badge"
                  [ngClass]="{
                    'bg-success': product.isAvailable,
                    'bg-danger': !product.isAvailable
                  }">
              {{ product.isAvailable ? 'Available' : 'Unavailable' }}
            </span>
          </td>
          <td>
            <span class="badge"
                  [ngClass]="{
                    'bg-success': product.isVisible && product.isAvailable,
                    'bg-warning': (!product.isVisible || !product.isAvailable),
                    'bg-danger': !product.isVisible && !product.isAvailable
                  }">
              {{ getProductStatus(product) }}
            </span>
          </td>
          <td>
            <div class="btn-group" role="group">
              <!-- Toggle Visibility -->
              <button type="button"
                      class="btn btn-sm"
                      [ngClass]="product.isVisible ? 'btn-warning' : 'btn-success'"
                      (click)="toggleVisibility(product._id)"
                      [disabled]="isLoading">
                <i class="fas" [ngClass]="product.isVisible ? 'fa-eye-slash' : 'fa-eye'"></i>
                {{ product.isVisible ? 'Hide' : 'Show' }}
              </button>

              <!-- Toggle Availability -->
              <button type="button"
                      class="btn btn-sm"
                      [ngClass]="product.isAvailable ? 'btn-warning' : 'btn-success'"
                      (click)="toggleAvailability(product._id)"
                      [disabled]="isLoading">
                <i class="fas" [ngClass]="product.isAvailable ? 'fa-times-circle' : 'fa-check-circle'"></i>
                {{ product.isAvailable ? 'Make Unavailable' : 'Make Available' }}
              </button>

              <!-- Edit -->
              <button type="button"
                      class="btn btn-sm btn-primary"
                      [routerLink]="['/admin/products/edit', product._id]">
                <i class="fas fa-edit"></i>
                Edit
              </button>

              <!-- Delete -->
              <button type="button"
                      class="btn btn-sm btn-danger"
                      (click)="deleteProduct(product._id)">
                <i class="fas fa-trash"></i>
                Delete
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="products.length === 0" class="text-center mt-4">
    <p>No products found.</p>
    <button class="btn btn-primary" routerLink="/admin/products/new">
      <i class="fas fa-plus"></i> Add New Product
    </button>
  </div>
</div>
